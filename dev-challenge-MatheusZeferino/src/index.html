<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<title>MultiSearch</title>
	</head>
	<body>
		<div class="container text-center">
			<div class="row justify-content-md-center">
			  	<div class="col-sm-8">
					<img src="../layout/logo_multisearch.png" width="40%" alt="MultiSearch Logo" class="d-inline-block align-text-top">
			  	</div>
		 	</div>
	  	</div>
		<div class="container">
		  	<div class="row justify-content-md-center">
				<div class="col-sm-8">
					<div class="input-group">
						<input type="text" id="filtro" name="filtro" class="form-control shadow-lg" placeholder="Insira o nome do Item" aria-label="Insira o nome do Item" aria-describedby="button-addon2">
						<button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="filtro()">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
								<path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Pula 3 Linhas -->
		<div class="container">
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
		</div>

		<div class="container">
			<div class="row">
				<div class="col-sm-6" style="padding:0px;">
					<p id="QtdTotalEncontrada" class="text-secondary text-center">(<span id="SpanQtdTotalEncontrada">0</span> itens encontrados)</p>
						
				</div>
			</div>
		</div>

		<!-- Pula 1 Linhas -->
		<div class="container">
			<div class="row">
				&nbsp;
			</div>
		</div>

		<div class="container">
		  	<div class="row justify-content-md-center">
				<div class="col-sm-8 card" style="padding:0px;">
					<div class="card-header">
						<div class="row justify-content-between">
							<div class="col-sm-5">
								<h3>Pedidos de Venda</h3>
							</div>
							<div class="col-sm-4">
								<p id="pPedidosVenda" class="text-secondary"></p>
							</div>
						</div>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<table class="table table-borderless">
							  	<tbody class="tablePedidosVenda" id="tablePedidosVenda">
							  	</tbody>
							</table>
							<p id="pCentroPedidosVenda" class="text-secondary text-center">Insira algo para pesquisar</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
		<!-- Pula 3 Linha -->
		<div class="container">
		  	<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
		</div>
		
		<div class="container">
		  	<div class="row justify-content-md-center">
				<div class="col-sm-8 card" style="padding:0px;">
					<div class="card-header">
						<div class="row justify-content-between">
							<div class="col-sm-5">
								<h3>Pedidos de Compra</h3>
							</div>
							<div class="col-sm-4">
								<p id="pPedidosCompra" class="text-secondary"></p>
							</div>
						</div>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<table class="table table-borderless">
							  	<tbody class="tablePedidosCompra" id="tablePedidosCompra">
							  	</tbody>
							</table>
							<p id="pCentroPedidosCompra" class="text-secondary text-center">Insira algo para pesquisar</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
		<!-- Pula 3 Linha -->
		<div class="container">
		  	<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
		</div>
		
		<div class="container">
		  	<div class="row justify-content-md-center">
				<div class="col-sm-8 card" style="padding:0px;">
					<div class="card-header">
						<div class="row justify-content-between">
							<div class="col-sm-5">
								<h3>Produtos</h3>
							</div>
							<div class="col-sm-4">
								<p id="pProdutos" class="text-secondary"></p>
							</div>
						</div>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<table class="table table-borderless">
							  	<tbody class="tableProdutos" id="tableProdutos">
							  	</tbody>
							</table>
							<p id="pCentroProdutos" class="text-secondary text-center">Insira algo para pesquisar</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
		<!-- Pula 3 Linha -->
		<div class="container">
		  	<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
		</div>
		
		<div class="container">
		  	<div class="row justify-content-md-center">
				<div class="col-sm-8 card" style="padding:0px;">
					<div class="card-header">
						<div class="row justify-content-between">
							<div class="col-sm-5">
								<h3>Equipamentos</h3>
							</div>
							<div class="col-sm-4">
								<p id="pEquipaments" class="text-secondary"></p>
							</div>
						</div>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<table class="table table-borderless">
							  	<tbody class="tableEquipaments" id="tableEquipaments">
							  	</tbody>
							</table>
							<p id="pCentroEquipaments" class="text-secondary text-center">Insira algo para pesquisar</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
		<!-- Pula 3 Linha -->
		<div class="container">
		  	<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
		</div>
		
		<div class="container">
		  	<div class="row justify-content-md-center">
				<div class="col-sm-8 card" style="padding:0px;">
					<div class="card-header">
						<div class="row justify-content-between">
							<div class="col-sm-5">
								<h3>Mão de Obra</h3>
							</div>
							<div class="col-sm-4">
								<p id="pMaoObra" class="text-secondary"></p>
							</div>
						</div>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<table class="table table-borderless">
							  	<tbody class="tableMaoObra" id="tableMaoObra">
							  	</tbody>
							</table>
							<p id="pCentroMaoObra" class="text-secondary text-center">Insira algo para pesquisar</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
		<!-- Pula 3 Linha -->
		<div class="container">
		  	<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
			<div class="row">
				&nbsp;
			</div>
		</div>
	
		<script>
			function filtro(){

				document.getElementById("SpanQtdTotalEncontrada").innerHTML = 0;
				document.querySelector(".tablePedidosVenda").innerHTML 	= "";
				document.querySelector(".tablePedidosCompra").innerHTML = "";
				document.querySelector(".tableProdutos").innerHTML 		= "";
				document.querySelector(".tableEquipaments").innerHTML 	= "";
				document.querySelector(".tableMaoObra").innerHTML 		= "";

				var lengthTotal = 0;
				var filtro = document.getElementById('filtro').value;
				const doGet = (url) => {
					const promiseCallBack = (resolve, reject) => {
						fetch(url)
							.then((response) => {
								if(!response.ok) throw new Error ('Error ao executar requisição, status '+ response.status);
								return response.json();	
							})
							.then(resolve)
							.catch(reject);
					}
					return new Promise(promiseCallBack);
				}


				//SALES
				doGet('http://localhost:3000/sales?q='+ filtro).then((result) => {
					document.getElementById("SpanQtdTotalEncontrada").innerHTML = parseInt(document.getElementById("SpanQtdTotalEncontrada").innerHTML) + result.length;
					
					if(result.length == 0){
						document.getElementById("pPedidosVenda").innerHTML = "(nenhum item encontrado)";
						document.getElementById("pCentroPedidosVenda").innerHTML = "nenhum item encontrado";
					}else if(result.length == 1){
						document.getElementById("ppPedidosVenda").innerHTML = "(1 item encontrado)";
						document.getElementById("pCentroPedidosVenda").innerHTML = "";
					}else{
						document.getElementById("pPedidosVenda").innerHTML = "(" + result.length + " itens encontrados)";
						document.getElementById("pCentroPedidosVenda").innerHTML = "";
					}
					result.forEach(element => {
						let row = document.createElement('tr');
						let col_1 = document.createElement('td');
						col_1.style.textDecoration = "underline";
						col_1.classList.add("link-danger");
						col_1.innerHTML = "#" + element.SalesOrderID;
						let col_2 = document.createElement('td');
						col_2.innerHTML = element.MaterialName;
						let col_3 = document.createElement('td');
						col_3.innerHTML = 'Qtd: ' + element.Quantity + ' pç';
						row.appendChild(col_1);
						row.appendChild(col_2);
						row.appendChild(col_3);
						document.getElementById("tablePedidosVenda").appendChild(row);
					});
				}).catch(console.error);



				//PURCHASE
				doGet('http://localhost:3000/purchase?q='+ filtro).then((result) => {
					document.getElementById("SpanQtdTotalEncontrada").innerHTML = parseInt(document.getElementById("SpanQtdTotalEncontrada").innerHTML) + result.length;
					
					if(result.length == 0){
						document.getElementById("pPedidosCompra").innerHTML = "(Nenhum item encontrado)";
						document.getElementById("pCentroPedidosCompra").innerHTML = "nenhum item encontrado";	
					}else if(result.length == 1){
						document.getElementById("pPedidosCompra").innerHTML = "(1 item encontrado)";
						document.getElementById("pCentroPedidosCompra").innerHTML = "";	
					}else{
						document.getElementById("pPedidosCompra").innerHTML = "(" + result.length + " itens encontrados)";	
						document.getElementById("pCentroPedidosCompra").innerHTML = "";	
					}
					result.forEach(element => {
						let row = document.createElement('tr');
						let col_1 = document.createElement('td');
						col_1.style.textDecoration = "underline";
						col_1.classList.add("link-danger");
						col_1.innerHTML = "#" + element.PurchaseOrderID;
						let col_2 = document.createElement('td');
						col_2.innerHTML = element.MaterialName;
						let col_3 = document.createElement('td');
						col_3.innerHTML = 'Qtd: ' + element.Quantity + ' pç';
						row.appendChild(col_1);
						row.appendChild(col_2);
						row.appendChild(col_3);
						document.getElementById("tablePedidosCompra").appendChild(row);
					});
				}).catch(console.error);

				//MATERIALS/Produtos
				doGet('http://localhost:3000/materials?q='+ filtro).then((result) => {
					document.getElementById("SpanQtdTotalEncontrada").innerHTML = parseInt(document.getElementById("SpanQtdTotalEncontrada").innerHTML) + result.length;
					
					if(result.length == 0){
						document.getElementById("pProdutos").innerHTML = "(Nenhum item encontrado)";
						document.getElementById("pCentroProdutos").innerHTML = "nenhum item encontrado";	
					}else if(result.length == 1){
						document.getElementById("pProdutos").innerHTML = "(1 item encontrado)";
						document.getElementById("pCentroProdutos").innerHTML = "";
					}else{
						document.getElementById("pProdutos").innerHTML = "(" + result.length + " itens encontrados)";
						document.getElementById("pCentroProdutos").innerHTML = "";	
					}
					result.forEach(element => {
						let row = document.createElement('tr');
						let col_1 = document.createElement('td');
						col_1.style.textDecoration = "underline";
						col_1.classList.add("link-danger");
						col_1.innerHTML = "#" + element.MaterialID;
						let col_2 = document.createElement('td');
						col_2.innerHTML = element.MaterialName;
						row.appendChild(col_1);
						row.appendChild(col_2);
						document.getElementById("tableProdutos").appendChild(row);
					});
				
				}).catch(console.error);

				//EQUIPAMENTS
				doGet('http://localhost:3000/equipaments?q='+ filtro).then((result) => {
					document.getElementById("SpanQtdTotalEncontrada").innerHTML = parseInt(document.getElementById("SpanQtdTotalEncontrada").innerHTML) + result.length;
					
					if(result.length == 0){
						document.getElementById("pEquipaments").innerHTML = "(Nenhum item encontrado)";
						document.getElementById("pCentroEquipaments").innerHTML = "nenhum item encontrado";	
					}else if(result.length == 1){
						document.getElementById("pEquipaments").innerHTML = "(1 item encontrado)";
						document.getElementById("pCentroEquipaments").innerHTML = "";
					}else{
						document.getElementById("pEquipaments").innerHTML = "(" + result.length + " itens encontrados)";
						document.getElementById("pCentroEquipaments").innerHTML = "";	
					}
					result.forEach(element => {
						let row = document.createElement('tr');
						let col_1 = document.createElement('td');
						col_1.style.textDecoration = "underline";
						col_1.classList.add("link-danger");
						col_1.innerHTML = "#" + element.EquipmentID;
						let col_2 = document.createElement('td');
						col_2.innerHTML = element.EquipmentName;
						row.appendChild(col_1);
						row.appendChild(col_2);
						document.getElementById("tableEquipaments").appendChild(row);
					});
				}).catch(console.error);	

				//WORKFORCE
				doGet('http://localhost:3000/workforce?q='+ filtro).then((result) => {
					document.getElementById("SpanQtdTotalEncontrada").innerHTML = parseInt(document.getElementById("SpanQtdTotalEncontrada").innerHTML) + result.length;
					
					if(result.length == 0){
						document.getElementById("pMaoObra").innerHTML = "(Nenhum item encontrado)"
						document.getElementById("pCentroMaoObra").innerHTML = "nenhum item encontrado";	
					}else if(result.length == 1){
						document.getElementById("pMaoObra").innerHTML = "(1 item encontrado)"
						document.getElementById("pCentroMaoObra").innerHTML = "";
					}else{
						document.getElementById("pMaoObra").innerHTML = "(" + result.length + " itens encontrados)"
						document.getElementById("pCentroMaoObra").innerHTML = "";	
					}
					result.forEach(element => {
						let row = document.createElement('tr');
						let col_1 = document.createElement('td');
						col_1.style.textDecoration = "underline";
						col_1.classList.add("link-danger");
						col_1.innerHTML = "#" + element.WorkforceID;
						let col_2 = document.createElement('td');
						col_2.innerHTML = element.Name;
						row.appendChild(col_1);
						row.appendChild(col_2);
						document.getElementById("tableMaoObra").appendChild(row);
					});
					
				
				}).catch(console.error);

			}
		</script>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
	</body>
</html>